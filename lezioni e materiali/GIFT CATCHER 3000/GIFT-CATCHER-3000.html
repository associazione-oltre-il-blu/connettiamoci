<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <title>üéÆ GIFT CATCHER 3000</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Press+Start+2P&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        background: #05010d;
        min-height: 100vh;
        overflow: hidden;
        font-family: "Orbitron", Arial, sans-serif;
      }

      .snow-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1;
        overflow: hidden;
      }
      .snowflake {
        position: absolute;
        top: -10px;
        color: white;
        text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
        animation: fall linear infinite;
        opacity: 0.7;
      }
      @keyframes fall {
        0% {
          transform: translateY(-10px) rotate(0deg);
        }
        100% {
          transform: translateY(100vh) rotate(360deg);
        }
      }

      .start-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #05010d;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 300;
        transition: opacity 0.5s, transform 0.5s;
      }
      .start-screen.nascosta {
        opacity: 0;
        transform: scale(1.1);
        pointer-events: none;
      }
      .logo {
        font-family: "Press Start 2P", monospace;
        font-size: 2.5rem;
        color: #05d9e8;
        text-shadow: 0 0 10px #05d9e8, 0 0 20px #05d9e8, 0 0 40px #05d9e8,
          0 0 80px #d300c5;
        text-align: center;
        line-height: 1.5;
        animation: lampeggio 2s infinite alternate;
      }
      @keyframes lampeggio {
        0%,
        19%,
        21%,
        23%,
        25%,
        54%,
        56%,
        100% {
          text-shadow: 0 0 10px #05d9e8, 0 0 20px #05d9e8, 0 0 40px #05d9e8,
            0 0 80px #d300c5;
        }
        20%,
        24%,
        55% {
          text-shadow: none;
        }
      }
      .sottotitolo {
        font-family: "Press Start 2P", monospace;
        font-size: 0.7rem;
        color: #ff2a6d;
        margin-top: 20px;
        letter-spacing: 5px;
        animation: pulse 1.5s infinite;
      }
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }
      .brand-start {
        font-family: "Orbitron", sans-serif;
        font-size: 0.9rem;
        color: #d300c5;
        margin-top: 15px;
        letter-spacing: 3px;
      }

      .input-nome {
        margin-top: 30px;
        text-align: center;
      }
      .input-nome label {
        display: block;
        font-family: "Press Start 2P", monospace;
        font-size: 0.5rem;
        color: #d300c5;
        margin-bottom: 8px;
      }
      .input-nome input,
      .input-nome select {
        padding: 12px 20px;
        font-family: "Orbitron", sans-serif;
        font-size: 1rem;
        background: rgba(5, 217, 232, 0.1);
        border: 2px solid #05d9e8;
        color: #05d9e8;
        text-align: center;
        border-radius: 5px;
        outline: none;
        width: 250px;
      }
      .input-nome input:focus,
      .input-nome select:focus {
        box-shadow: 0 0 20px #05d9e8;
      }
      .input-nome input::placeholder {
        color: rgba(5, 217, 232, 0.5);
      }
      .difficulty-select {
        margin-top: 20px;
      }
      .difficulty-select select {
        cursor: pointer;
      }
      .difficulty-select option {
        background: #05010d;
      }

      .btn-start {
        margin-top: 25px;
        padding: 18px 45px;
        font-family: "Press Start 2P", monospace;
        font-size: 0.9rem;
        background: transparent;
        border: 3px solid #ff2a6d;
        color: #ff2a6d;
        cursor: pointer;
        transition: all 0.3s;
      }
      .btn-start:hover {
        background: #ff2a6d;
        color: #05010d;
        box-shadow: 0 0 30px #ff2a6d;
        transform: scale(1.05);
      }

      .audio-controls {
        position: fixed;
        bottom: 20px;
        right: 20px;
        display: flex;
        align-items: center;
        gap: 12px;
        z-index: 500;
        background: rgba(5, 1, 13, 0.9);
        padding: 10px 15px;
        border-radius: 25px;
        border: 2px solid #d300c5;
        box-shadow: 0 0 20px rgba(211, 0, 197, 0.3);
      }
      .audio-btn {
        width: 40px;
        height: 40px;
        background: rgba(211, 0, 197, 0.3);
        border: 2px solid #d300c5;
        border-radius: 50%;
        font-size: 1.2rem;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .audio-btn:hover {
        background: rgba(211, 0, 197, 0.5);
        transform: scale(1.1);
      }
      .audio-btn.muted {
        opacity: 0.5;
        border-color: #666;
        background: rgba(100, 100, 100, 0.2);
      }
      .volume-slider {
        -webkit-appearance: none;
        width: 80px;
        height: 6px;
        border-radius: 3px;
        background: linear-gradient(90deg, #d300c5, #05d9e8);
        outline: none;
        cursor: pointer;
      }
      .volume-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: #ffffff;
        cursor: pointer;
        box-shadow: 0 0 10px #d300c5;
      }
      .volume-slider::-moz-range-thumb {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: #ffffff;
        cursor: pointer;
        border: none;
        box-shadow: 0 0 10px #d300c5;
      }
      .volume-value {
        font-family: "Orbitron", sans-serif;
        font-size: 0.7rem;
        color: #05d9e8;
        min-width: 35px;
        text-align: center;
      }

      /* HOME BUTTON */
      .btn-home {
        position: fixed;
        top: 70px;
        left: 20px;
        width: 45px;
        height: 45px;
        background: rgba(5, 217, 232, 0.3);
        border: 2px solid #05d9e8;
        border-radius: 10px;
        font-size: 1.3rem;
        cursor: pointer;
        z-index: 150;
        box-shadow: 0 0 15px rgba(5, 217, 232, 0.5);
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .btn-home:hover {
        background: rgba(5, 217, 232, 0.5);
        transform: scale(1.1);
        box-shadow: 0 0 25px #05d9e8;
      }

      .hud {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        padding: 15px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 100;
        background: linear-gradient(
          180deg,
          rgba(0, 0, 0, 0.9) 0%,
          transparent 100%
        );
      }
      .punteggio {
        font-family: "Press Start 2P", monospace;
        font-size: 0.9rem;
        color: #f9f002;
        text-shadow: 0 0 10px #f9f002;
      }
      .punteggio span {
        color: #05d9e8;
      }
      .livello {
        font-family: "Press Start 2P", monospace;
        font-size: 0.7rem;
        color: #d300c5;
        text-shadow: 0 0 10px #d300c5;
      }
      .difficulty-display {
        font-family: "Press Start 2P", monospace;
        font-size: 0.5rem;
        color: #05d9e8;
      }
      .vite {
        font-size: 1.2rem;
        filter: drop-shadow(0 0 5px #ff2a6d);
      }

      .griglia {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 40%;
        background: linear-gradient(
            90deg,
            rgba(5, 217, 232, 0.1) 1px,
            transparent 1px
          ),
          linear-gradient(rgba(5, 217, 232, 0.1) 1px, transparent 1px);
        background-size: 50px 50px;
        transform: perspective(500px) rotateX(60deg);
        transform-origin: bottom;
        animation: movimento 2s linear infinite;
      }
      @keyframes movimento {
        0% {
          background-position: 0 0;
        }
        100% {
          background-position: 0 50px;
        }
      }

      .player {
        position: fixed;
        bottom: 30px;
        width: 100px;
        height: 70px;
        background: linear-gradient(180deg, #d300c5 0%, #ff2a6d 100%);
        border: 3px solid #05d9e8;
        border-radius: 10px 10px 30px 30px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 2.5rem;
        box-shadow: 0 0 20px #d300c5, 0 0 40px #ff2a6d;
        transform: translateX(-50%);
        z-index: 20;
        transition: left 0.05s;
      }

      .oggetto {
        position: fixed;
        font-size: 2.5rem;
        filter: drop-shadow(0 0 15px #05d9e8);
        animation: dondolo 0.5s ease-in-out infinite alternate;
        z-index: 10;
      }
      .oggetto.nemico {
        filter: drop-shadow(0 0 15px #ff2a6d);
      }
      @keyframes dondolo {
        0% {
          transform: rotate(-10deg);
        }
        100% {
          transform: rotate(10deg);
        }
      }

      .popup-punti {
        position: fixed;
        font-family: "Press Start 2P", monospace;
        font-size: 1rem;
        color: #f9f002;
        text-shadow: 0 0 10px #f9f002;
        pointer-events: none;
        animation: saliScompari 1s forwards;
        z-index: 50;
      }
      .popup-punti.negativo {
        color: #ff2a6d;
        text-shadow: 0 0 10px #ff2a6d;
      }
      @keyframes saliScompari {
        0% {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
        100% {
          opacity: 0;
          transform: translateY(-80px) scale(1.5);
        }
      }

      .combo {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-family: "Press Start 2P", monospace;
        font-size: 1.5rem;
        color: #f9f002;
        text-shadow: 0 0 20px #f9f002;
        opacity: 0;
        pointer-events: none;
        z-index: 100;
      }
      .combo.visibile {
        animation: comboAnim 1s forwards;
      }
      @keyframes comboAnim {
        0% {
          opacity: 0;
          transform: translate(-50%, -50%) scale(0.5);
        }
        20% {
          opacity: 1;
          transform: translate(-50%, -50%) scale(1.2);
        }
        80% {
          opacity: 1;
        }
        100% {
          opacity: 0;
          transform: translate(-50%, -50%) scale(1.5);
        }
      }

      .new-record {
        position: fixed;
        top: 30%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-family: "Press Start 2P", monospace;
        font-size: 1.2rem;
        color: #f9f002;
        text-shadow: 0 0 20px #f9f002, 0 0 40px #ff2a6d;
        opacity: 0;
        pointer-events: none;
        z-index: 100;
        text-align: center;
      }
      .new-record.visibile {
        animation: newRecordAnim 2s forwards;
      }
      @keyframes newRecordAnim {
        0% {
          opacity: 0;
          transform: translate(-50%, -50%) scale(0.5) rotate(-10deg);
        }
        20% {
          opacity: 1;
          transform: translate(-50%, -50%) scale(1.3) rotate(5deg);
        }
        40% {
          transform: translate(-50%, -50%) scale(1.1) rotate(-3deg);
        }
        60% {
          transform: translate(-50%, -50%) scale(1.2) rotate(2deg);
        }
        80% {
          opacity: 1;
        }
        100% {
          opacity: 0;
          transform: translate(-50%, -50%) scale(1.5) rotate(0deg);
        }
      }

      .game-over-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(5, 1, 13, 0.98);
        display: none;
        z-index: 200;
        overflow-y: auto;
      }
      .game-over-screen.visibile {
        display: flex;
        justify-content: center;
        align-items: center;
        animation: fadeIn 0.5s;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      .game-over-content {
        display: flex;
        padding: 20px;
        gap: 25px;
        justify-content: center;
        align-items: stretch;
        flex-wrap: nowrap;
      }

      .card-editor {
        background: rgba(13, 2, 33, 0.9);
        border: 2px solid #d300c5;
        border-radius: 15px;
        padding: 18px;
        width: 280px;
        box-shadow: 0 0 30px rgba(211, 0, 197, 0.3);
        flex-shrink: 0;
        display: flex;
        flex-direction: column;
      }
      .editor-title {
        font-family: "Press Start 2P", monospace;
        font-size: 0.6rem;
        color: #05d9e8;
        text-align: center;
        margin-bottom: 15px;
        text-shadow: 0 0 10px #05d9e8;
      }
      .editor-section {
        margin-bottom: 14px;
      }
      .editor-section label {
        display: block;
        font-family: "Press Start 2P", monospace;
        font-size: 0.4rem;
        color: #ff2a6d;
        margin-bottom: 6px;
        letter-spacing: 1px;
      }
      .editor-section select,
      .editor-section input[type="text"] {
        width: 100%;
        padding: 8px;
        background: #05010d;
        border: 2px solid #05d9e8;
        color: #05d9e8;
        font-family: "Orbitron", sans-serif;
        font-size: 0.8rem;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s;
      }
      .editor-section select:hover,
      .editor-section input[type="text"]:focus {
        box-shadow: 0 0 15px #05d9e8;
        outline: none;
      }
      .editor-section input[type="text"]::placeholder {
        color: rgba(5, 217, 232, 0.4);
      }

      .avatar-grid {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 5px;
      }
      .avatar-option {
        width: 100%;
        aspect-ratio: 1;
        font-size: 1.2rem;
        background: #05010d;
        border: 2px solid #333;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .avatar-option:hover {
        border-color: #05d9e8;
        transform: scale(1.1);
      }
      .avatar-option.selected {
        border-color: #f9f002;
        box-shadow: 0 0 12px #f9f002;
        background: rgba(249, 240, 2, 0.1);
      }

      .theme-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 6px;
      }
      .theme-option {
        height: 32px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
        border: 2px solid transparent;
        position: relative;
        overflow: hidden;
      }
      .theme-option:hover {
        transform: scale(1.05);
      }
      .theme-option.selected {
        border-color: white;
        box-shadow: 0 0 12px white;
      }
      .theme-option span {
        position: absolute;
        bottom: 1px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 0.3rem;
        color: white;
        text-shadow: 0 0 3px black, 0 0 3px black;
        font-family: "Press Start 2P", monospace;
      }

      .card-preview {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
        flex-shrink: 0;
      }
      .score-card {
        width: 340px;
        min-height: 480px;
        border-radius: 18px;
        padding: 22px;
        position: relative;
        overflow: hidden;
        transition: all 0.3s;
      }
      .score-card.theme-cyberpunk {
        background: linear-gradient(
          135deg,
          #0d0221 0%,
          #1a0a2e 50%,
          #16213e 100%
        );
        --card-primary: #05d9e8;
        --card-secondary: #d300c5;
        --card-accent: #ff2a6d;
        --card-highlight: #f9f002;
      }
      .score-card.theme-christmas {
        background: linear-gradient(
          135deg,
          #1a472a 0%,
          #2d5a3d 50%,
          #165b33 100%
        );
        --card-primary: #ffd700;
        --card-secondary: #ff6b6b;
        --card-accent: #c41e3a;
        --card-highlight: #ffffff;
      }
      .score-card.theme-arcade {
        background: linear-gradient(
          135deg,
          #1a1a2e 0%,
          #16213e 50%,
          #0f3460 100%
        );
        --card-primary: #e94560;
        --card-secondary: #533483;
        --card-accent: #0f3460;
        --card-highlight: #f9f002;
      }
      .score-card.theme-vaporwave {
        background: linear-gradient(
          135deg,
          #1a0533 0%,
          #2d1b4e 50%,
          #120458 100%
        );
        --card-primary: #ff71ce;
        --card-secondary: #01cdfe;
        --card-accent: #05ffa1;
        --card-highlight: #fffb96;
      }
      .score-card.theme-matrix {
        background: linear-gradient(
          135deg,
          #0a0a0a 0%,
          #0d1a0d 50%,
          #001a00 100%
        );
        --card-primary: #00ff41;
        --card-secondary: #008f11;
        --card-accent: #00ff41;
        --card-highlight: #00ff41;
      }
      .score-card.theme-sunset {
        background: linear-gradient(
          135deg,
          #1a1a2e 0%,
          #2d132c 50%,
          #4a1942 100%
        );
        --card-primary: #ff9a56;
        --card-secondary: #ff6b95;
        --card-accent: #c44569;
        --card-highlight: #ffda77;
      }
      .score-card.theme-ice {
        background: linear-gradient(
          135deg,
          #0c1445 0%,
          #1a237e 50%,
          #0d47a1 100%
        );
        --card-primary: #81d4fa;
        --card-secondary: #4fc3f7;
        --card-accent: #29b6f6;
        --card-highlight: #ffffff;
      }
      .score-card.theme-fire {
        background: linear-gradient(
          135deg,
          #1a0a00 0%,
          #2d1810 50%,
          #3d1a0a 100%
        );
        --card-primary: #ff9800;
        --card-secondary: #ff5722;
        --card-accent: #f44336;
        --card-highlight: #ffeb3b;
      }
      .score-card::before {
        content: "";
        position: absolute;
        top: -3px;
        left: -3px;
        right: -3px;
        bottom: -3px;
        background: linear-gradient(
          45deg,
          var(--card-primary),
          var(--card-secondary),
          var(--card-accent),
          var(--card-highlight)
        );
        border-radius: 20px;
        z-index: -1;
      }

      .card-bg-effect {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        pointer-events: none;
        opacity: 0.3;
        border-radius: 18px;
      }
      .card-bg-effect.effect-none {
        display: none;
      }
      .card-bg-effect.effect-grid {
        background: linear-gradient(
            90deg,
            var(--card-primary) 1px,
            transparent 1px
          ),
          linear-gradient(var(--card-primary) 1px, transparent 1px);
        background-size: 30px 30px;
        opacity: 0.1;
      }
      .card-bg-effect.effect-dots {
        background-image: radial-gradient(
          var(--card-primary) 1px,
          transparent 1px
        );
        background-size: 20px 20px;
        opacity: 0.2;
      }
      .card-bg-effect.effect-stars {
        background-image: radial-gradient(
            2px 2px at 20px 30px,
            var(--card-highlight),
            transparent
          ),
          radial-gradient(
            2px 2px at 40px 70px,
            var(--card-primary),
            transparent
          ),
          radial-gradient(
            1px 1px at 90px 40px,
            var(--card-highlight),
            transparent
          ),
          radial-gradient(
            2px 2px at 130px 80px,
            var(--card-secondary),
            transparent
          ),
          radial-gradient(
            1px 1px at 160px 30px,
            var(--card-highlight),
            transparent
          ),
          radial-gradient(
            2px 2px at 200px 60px,
            var(--card-primary),
            transparent
          ),
          radial-gradient(
            1px 1px at 250px 20px,
            var(--card-highlight),
            transparent
          ),
          radial-gradient(
            2px 2px at 300px 90px,
            var(--card-secondary),
            transparent
          );
        background-size: 350px 120px;
      }
      .card-bg-effect.effect-circuit {
        background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 0v15m0 30v15M0 30h15m30 0h15M15 15l10 10m10 10l10 10M45 15l-10 10m-10 10l-10 10' stroke='%2305d9e8' stroke-width='1' fill='none' opacity='0.3'/%3E%3Ccircle cx='30' cy='30' r='3' fill='%2305d9e8' opacity='0.5'/%3E%3C/svg%3E");
        background-size: 60px 60px;
        opacity: 0.15;
      }
      .card-bg-effect.effect-snow {
        background-image: radial-gradient(
            3px 3px at 10% 20%,
            white,
            transparent
          ),
          radial-gradient(2px 2px at 30% 50%, white, transparent),
          radial-gradient(3px 3px at 50% 10%, white, transparent),
          radial-gradient(2px 2px at 70% 60%, white, transparent),
          radial-gradient(3px 3px at 90% 30%, white, transparent),
          radial-gradient(2px 2px at 20% 80%, white, transparent);
        background-size: 100% 100%;
      }

      .card-content {
        position: relative;
        z-index: 1;
      }
      .card-header {
        text-align: center;
        margin-bottom: 12px;
      }
      .card-project-name {
        font-family: "Orbitron", sans-serif;
        font-size: 0.6rem;
        color: var(--card-secondary);
        letter-spacing: 3px;
        text-transform: uppercase;
        margin-bottom: 4px;
      }
      .card-logo {
        font-family: "Press Start 2P", monospace;
        font-size: 0.5rem;
        color: var(--card-primary);
        text-shadow: 0 0 10px var(--card-primary);
        letter-spacing: 1px;
      }
      .card-custom-title {
        font-family: "Press Start 2P", monospace;
        font-size: 0.8rem;
        color: var(--card-accent);
        text-shadow: 0 0 15px var(--card-accent);
        margin-top: 6px;
      }
      .card-player-section {
        text-align: center;
        margin: 15px 0;
        padding: 15px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      .card-player-avatar {
        font-size: 3.5rem;
        display: block;
        margin-bottom: 8px;
        filter: drop-shadow(0 0 15px var(--card-secondary));
      }
      .card-player-name {
        font-family: "Orbitron", sans-serif;
        font-size: 1.4rem;
        font-weight: 900;
        color: #ffffff;
        text-shadow: 0 0 10px var(--card-primary);
        text-transform: uppercase;
        letter-spacing: 2px;
      }
      .card-player-motto {
        font-family: "Orbitron", sans-serif;
        font-size: 0.7rem;
        color: var(--card-secondary);
        margin-top: 6px;
        font-style: italic;
        display: none;
      }
      .card-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin: 12px 0;
      }
      .card-stat {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 10px;
        text-align: center;
      }
      .card-stat-label {
        font-family: "Press Start 2P", monospace;
        font-size: 0.3rem;
        color: var(--card-secondary);
        text-transform: uppercase;
        letter-spacing: 1px;
      }
      .card-stat-value {
        font-family: "Orbitron", sans-serif;
        font-size: 1.2rem;
        font-weight: 900;
        color: var(--card-highlight);
        text-shadow: 0 0 10px var(--card-highlight);
        margin-top: 4px;
      }
      .card-stat.score-main {
        grid-column: 1 / -1;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.1),
          rgba(255, 255, 255, 0.05)
        );
        border-color: var(--card-highlight);
      }
      .card-stat.score-main .card-stat-value {
        font-size: 2.2rem;
      }
      .card-badge {
        position: absolute;
        top: 12px;
        right: 12px;
        background: linear-gradient(
          135deg,
          var(--card-highlight),
          var(--card-accent)
        );
        color: #000;
        font-family: "Press Start 2P", monospace;
        font-size: 0.35rem;
        padding: 6px 8px;
        border-radius: 4px;
        transform: rotate(3deg);
        box-shadow: 0 0 12px var(--card-highlight);
      }
      .card-footer {
        text-align: center;
        margin-top: 12px;
        padding-top: 10px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }
      .card-date {
        font-family: "Orbitron", sans-serif;
        font-size: 0.55rem;
        color: rgba(255, 255, 255, 0.5);
      }
      .card-project-footer {
        font-family: "Orbitron", sans-serif;
        font-size: 0.5rem;
        color: var(--card-primary);
        margin-top: 6px;
        letter-spacing: 1px;
      }

      .card-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: center;
      }
      .btn-card {
        padding: 10px 16px;
        font-family: "Press Start 2P", monospace;
        font-size: 0.45rem;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 5px;
      }
      .btn-download {
        background: linear-gradient(135deg, #05d9e8, #00a8cc);
        color: #0d0221;
      }
      .btn-print {
        background: linear-gradient(135deg, #f9f002, #ff9800);
        color: #0d0221;
      }
      .btn-retry {
        background: linear-gradient(135deg, #ff2a6d, #d300c5);
        color: white;
      }
      .btn-home-end {
        background: linear-gradient(135deg, #05d9e8, #05d9e8);
        color: #0d0221;
      }
      .btn-leaderboard {
        background: linear-gradient(135deg, #f9f002, #ffeb3b);
        color: #0d0221;
      }
      .btn-card:hover {
        transform: scale(1.05);
        box-shadow: 0 0 20px currentColor;
      }
      .btn-card:disabled {
        opacity: 0.5;
        cursor: wait;
      }

      .pannello-toggle {
        position: fixed;
        top: 70px;
        right: 20px;
        width: 45px;
        height: 45px;
        background: #d300c5;
        border: none;
        border-radius: 10px;
        font-size: 1.3rem;
        cursor: pointer;
        z-index: 150;
        box-shadow: 0 0 15px #d300c5;
        transition: all 0.3s;
      }
      .pannello-toggle:hover {
        transform: rotate(90deg) scale(1.1);
      }
      .pannello {
        position: fixed;
        top: 70px;
        right: 20px;
        background: rgba(13, 2, 33, 0.95);
        border: 2px solid #d300c5;
        border-radius: 10px;
        padding: 20px;
        z-index: 140;
        min-width: 200px;
        box-shadow: 0 0 20px #d300c5;
        transform: translateX(280px);
        transition: transform 0.3s;
      }
      .pannello.aperto {
        transform: translateX(0);
      }
      .pannello h3 {
        font-family: "Press Start 2P", monospace;
        font-size: 0.5rem;
        color: #05d9e8;
        margin-bottom: 12px;
        text-align: center;
      }
      .opzione {
        margin-bottom: 10px;
      }
      .opzione label {
        display: block;
        font-size: 0.5rem;
        color: #ff2a6d;
        margin-bottom: 4px;
      }
      .opzione select {
        width: 100%;
        padding: 6px;
        background: #05010d;
        border: 1px solid #05d9e8;
        color: #05d9e8;
        font-size: 12px;
        border-radius: 4px;
      }

      /* LEADERBOARD MODAL */
      .leaderboard-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(5, 1, 13, 0.95);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 400;
      }
      .leaderboard-modal.visibile {
        display: flex;
      }
      .leaderboard-box {
        background: rgba(13, 2, 33, 0.95);
        border: 3px solid #f9f002;
        border-radius: 15px;
        padding: 25px;
        max-width: 400px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
      }
      .leaderboard-title {
        font-family: "Press Start 2P", monospace;
        font-size: 0.8rem;
        color: #f9f002;
        text-align: center;
        margin-bottom: 20px;
        text-shadow: 0 0 10px #f9f002;
      }
      .leaderboard-list {
        list-style: none;
      }
      .leaderboard-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        margin-bottom: 8px;
        background: rgba(5, 217, 232, 0.1);
        border: 1px solid #05d9e8;
        border-radius: 8px;
      }
      .leaderboard-item.gold {
        border-color: #ffd700;
        background: rgba(255, 215, 0, 0.15);
      }
      .leaderboard-item.silver {
        border-color: #c0c0c0;
        background: rgba(192, 192, 192, 0.1);
      }
      .leaderboard-item.bronze {
        border-color: #cd7f32;
        background: rgba(205, 127, 50, 0.1);
      }
      .leaderboard-rank {
        font-family: "Press Start 2P", monospace;
        font-size: 0.6rem;
        color: #d300c5;
        min-width: 30px;
      }
      .leaderboard-name {
        font-family: "Orbitron", sans-serif;
        font-size: 0.9rem;
        color: #05d9e8;
        flex: 1;
        margin: 0 10px;
      }
      .leaderboard-score {
        font-family: "Press Start 2P", monospace;
        font-size: 0.6rem;
        color: #f9f002;
      }
      .leaderboard-difficulty {
        font-family: "Orbitron", sans-serif;
        font-size: 0.5rem;
        color: #ff2a6d;
        margin-left: 8px;
      }
      .leaderboard-empty {
        text-align: center;
        color: #666;
        font-size: 0.8rem;
        padding: 20px;
      }
      .btn-close-leaderboard {
        margin-top: 20px;
        width: 100%;
        padding: 12px;
        font-family: "Press Start 2P", monospace;
        font-size: 0.5rem;
        background: #ff2a6d;
        border: none;
        color: white;
        border-radius: 8px;
        cursor: pointer;
      }
      .btn-close-leaderboard:hover {
        background: #d300c5;
      }
      .btn-clear-scores {
        margin-top: 10px;
        width: 100%;
        padding: 8px;
        font-family: "Orbitron", sans-serif;
        font-size: 0.6rem;
        background: transparent;
        border: 1px solid #666;
        color: #666;
        border-radius: 8px;
        cursor: pointer;
      }
      .btn-clear-scores:hover {
        border-color: #ff2a6d;
        color: #ff2a6d;
      }

      .shake {
        animation: shakeScreen 0.3s;
      }
      @keyframes shakeScreen {
        0%,
        100% {
          transform: translateX(0);
        }
        20% {
          transform: translateX(-10px);
        }
        40% {
          transform: translateX(10px);
        }
        60% {
          transform: translateX(-10px);
        }
        80% {
          transform: translateX(10px);
        }
      }
      .istruzioni {
        position: fixed;
        bottom: 10px;
        width: 100%;
        text-align: center;
        font-family: "Press Start 2P", monospace;
        font-size: 0.35rem;
        color: #05d9e8;
        opacity: 0.5;
        z-index: 5;
      }
      .scanlines {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: repeating-linear-gradient(
          0deg,
          rgba(0, 0, 0, 0.1) 0px,
          rgba(0, 0, 0, 0.1) 1px,
          transparent 1px,
          transparent 2px
        );
        pointer-events: none;
        z-index: 1000;
      }

      @media print {
        body * {
          visibility: hidden;
        }
        .score-card,
        .score-card * {
          visibility: visible;
        }
        .score-card {
          position: fixed;
          left: 50%;
          top: 50%;
          transform: translate(-50%, -50%);
          width: 340px;
          box-shadow: none !important;
          -webkit-print-color-adjust: exact;
          print-color-adjust: exact;
        }
        .score-card::before {
          display: none;
        }
        .scanlines {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="scanlines"></div>
    <div class="snow-container" id="snowContainer"></div>

    <div class="audio-controls">
      <button
        class="audio-btn"
        id="musicToggle"
        onclick="toggleMusic()"
        title="Musica ON/OFF"
      >
        üéµ
      </button>
      <input
        type="range"
        class="volume-slider"
        id="volumeSlider"
        min="0"
        max="100"
        value="30"
        oninput="setVolume(this.value)"
      />
      <span class="volume-value" id="volumeValue">30%</span>
    </div>

    <!-- HOME BUTTON -->
    <button
      class="btn-home"
      id="btnHome"
      onclick="tornaHome()"
      title="Torna alla Home"
    >
      üè†
    </button>

    <div class="start-screen" id="startScreen">
      <div class="logo">üéÅ GIFT<br />CATCHER<br />3000 üéÅ</div>
      <div class="sottotitolo">‚ùÑÔ∏è CHRISTMAS ARCADE ‚ùÑÔ∏è</div>
      <div class="brand-start">‚Äî Connettiamoci ‚Äî</div>
      <div class="input-nome">
        <label>INSERISCI IL TUO NOME</label>
        <input
          type="text"
          id="nomeGiocatore"
          placeholder="Il tuo nome..."
          maxlength="12"
        />
      </div>
      <div class="input-nome difficulty-select">
        <label>DIFFICOLT√Ä</label>
        <select id="difficultySelect">
          <option value="easy">üòä Facile</option>
          <option value="normal" selected>üòê Normale</option>
          <option value="hard">üòà Difficile</option>
          <option value="impossible">üíÄ Impossibile</option>
        </select>
      </div>
      <button class="btn-start" id="btnStart">‚ñ∂ START</button>
    </div>

    <div class="hud">
      <div>
        <div class="punteggio">SCORE: <span id="score">0</span></div>
        <div class="difficulty-display" id="difficultyDisplay">NORMALE</div>
      </div>
      <div class="livello">LVL <span id="livello">1</span></div>
      <div class="vite" id="vite">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
    </div>

    <div class="griglia"></div>
    <div class="player" id="player">üõ∑</div>
    <div class="combo" id="combo"></div>
    <div class="new-record" id="newRecord">üéâ NUOVO RECORD! üéâ</div>

    <!-- LEADERBOARD MODAL -->
    <div class="leaderboard-modal" id="leaderboardModal">
      <div class="leaderboard-box">
        <div class="leaderboard-title">üèÜ TOP 10 PUNTEGGI üèÜ</div>
        <ul class="leaderboard-list" id="leaderboardList"></ul>
        <button class="btn-close-leaderboard" onclick="hideLeaderboard()">
          CHIUDI
        </button>
        <button class="btn-clear-scores" onclick="clearScores()">
          üóëÔ∏è Cancella tutti i punteggi
        </button>
      </div>
    </div>

    <div class="game-over-screen" id="gameOverScreen">
      <div class="game-over-content">
        <div class="card-editor">
          <div class="editor-title">‚ú® PERSONALIZZA CARD ‚ú®</div>
          <div class="editor-section">
            <label>üé® TEMA COLORE</label>
            <div class="theme-grid">
              <div
                class="theme-option selected"
                data-theme="cyberpunk"
                style="background: linear-gradient(135deg, #05d9e8, #d300c5)"
                onclick="setTheme('cyberpunk')"
              >
                <span>CYBER</span>
              </div>
              <div
                class="theme-option"
                data-theme="christmas"
                style="background: linear-gradient(135deg, #1a472a, #c41e3a)"
                onclick="setTheme('christmas')"
              >
                <span>XMAS</span>
              </div>
              <div
                class="theme-option"
                data-theme="arcade"
                style="background: linear-gradient(135deg, #e94560, #533483)"
                onclick="setTheme('arcade')"
              >
                <span>ARCADE</span>
              </div>
              <div
                class="theme-option"
                data-theme="vaporwave"
                style="background: linear-gradient(135deg, #ff71ce, #01cdfe)"
                onclick="setTheme('vaporwave')"
              >
                <span>VAPOR</span>
              </div>
              <div
                class="theme-option"
                data-theme="matrix"
                style="background: linear-gradient(135deg, #00ff41, #003300)"
                onclick="setTheme('matrix')"
              >
                <span>MATRIX</span>
              </div>
              <div
                class="theme-option"
                data-theme="sunset"
                style="background: linear-gradient(135deg, #ff9a56, #c44569)"
                onclick="setTheme('sunset')"
              >
                <span>SUNSET</span>
              </div>
              <div
                class="theme-option"
                data-theme="ice"
                style="background: linear-gradient(135deg, #81d4fa, #0d47a1)"
                onclick="setTheme('ice')"
              >
                <span>ICE</span>
              </div>
              <div
                class="theme-option"
                data-theme="fire"
                style="background: linear-gradient(135deg, #ff9800, #f44336)"
                onclick="setTheme('fire')"
              >
                <span>FIRE</span>
              </div>
            </div>
          </div>
          <div class="editor-section">
            <label>üë§ AVATAR</label>
            <div class="avatar-grid">
              <div class="avatar-option selected" onclick="setAvatar('üéÆ')">
                üéÆ
              </div>
              <div class="avatar-option" onclick="setAvatar('üëæ')">üëæ</div>
              <div class="avatar-option" onclick="setAvatar('ü§ñ')">ü§ñ</div>
              <div class="avatar-option" onclick="setAvatar('üéÖ')">üéÖ</div>
              <div class="avatar-option" onclick="setAvatar('‚õÑ')">‚õÑ</div>
              <div class="avatar-option" onclick="setAvatar('ü¶å')">ü¶å</div>
              <div class="avatar-option" onclick="setAvatar('üê±')">üê±</div>
              <div class="avatar-option" onclick="setAvatar('ü¶ä')">ü¶ä</div>
              <div class="avatar-option" onclick="setAvatar('üê∫')">üê∫</div>
              <div class="avatar-option" onclick="setAvatar('üëª')">üëª</div>
              <div class="avatar-option" onclick="setAvatar('üéÑ')">üéÑ</div>
              <div class="avatar-option" onclick="setAvatar('‚≠ê')">‚≠ê</div>
              <div class="avatar-option" onclick="setAvatar('üî•')">üî•</div>
              <div class="avatar-option" onclick="setAvatar('üíé')">üíé</div>
              <div class="avatar-option" onclick="setAvatar('üëë')">üëë</div>
              <div class="avatar-option" onclick="setAvatar('üéÅ')">üéÅ</div>
              <div class="avatar-option" onclick="setAvatar('‚ö°')">‚ö°</div>
              <div class="avatar-option" onclick="setAvatar('‚ùÑÔ∏è')">‚ùÑÔ∏è</div>
            </div>
          </div>
          <div class="editor-section">
            <label>‚ú® EFFETTO SFONDO</label>
            <select id="effectSelect" onchange="setEffect(this.value)">
              <option value="none">Nessuno</option>
              <option value="grid">Griglia</option>
              <option value="dots">Puntini</option>
              <option value="stars" selected>Stelle</option>
              <option value="circuit">Circuiti</option>
              <option value="snow">Neve</option>
            </select>
          </div>
          <div class="editor-section">
            <label>üè∑Ô∏è TITOLO CARD</label>
            <select id="titleSelect" onchange="setTitle(this.value)">
              <option value="GAME COMPLETE">GAME COMPLETE</option>
              <option value="MERRY CHRISTMAS!">MERRY CHRISTMAS!</option>
              <option value="MISSION ACCOMPLISHED">MISSION ACCOMPLISHED</option>
              <option value="LEVEL CLEARED">LEVEL CLEARED</option>
              <option value="EPIC WIN">EPIC WIN</option>
              <option value="GG WELL PLAYED">GG WELL PLAYED</option>
              <option value="HIGH SCORE">HIGH SCORE</option>
            </select>
          </div>
          <div class="editor-section">
            <label>üí¨ IL TUO MOTTO</label>
            <input
              type="text"
              id="mottoInput"
              placeholder="Es: Gaming is life!"
              maxlength="25"
              oninput="setMotto(this.value)"
            />
          </div>
        </div>
        <div class="card-preview">
          <div class="score-card theme-cyberpunk" id="scoreCard">
            <div class="card-bg-effect effect-stars" id="cardBgEffect"></div>
            <div class="card-badge" id="cardBadge">‚≠ê PLAYER</div>
            <div class="card-content">
              <div class="card-header">
                <div class="card-project-name">‚ú¶ Connettiamoci ‚ú¶</div>
                <div class="card-logo">üéÆ GIFT CATCHER 3000 üéÆ</div>
                <div class="card-custom-title" id="cardTitle">
                  GAME COMPLETE
                </div>
              </div>
              <div class="card-player-section">
                <span class="card-player-avatar" id="cardAvatar">üéÆ</span>
                <div class="card-player-name" id="cardNome">PLAYER</div>
                <div class="card-player-motto" id="cardMotto"></div>
              </div>
              <div class="card-stats">
                <div class="card-stat score-main">
                  <div class="card-stat-label">PUNTEGGIO</div>
                  <div class="card-stat-value" id="cardScore">0</div>
                </div>
                <div class="card-stat">
                  <div class="card-stat-label">LIVELLO</div>
                  <div class="card-stat-value" id="cardLivello">1</div>
                </div>
                <div class="card-stat">
                  <div class="card-stat-label">RECORD</div>
                  <div class="card-stat-value" id="cardRecord">0</div>
                </div>
              </div>
              <div class="card-footer">
                <div class="card-date" id="cardData">11 Dicembre 2024</div>
                <div class="card-project-footer">
                  Progetto Connettiamoci ‚Ä¢ 11 Dicembre 2024
                </div>
              </div>
            </div>
          </div>
          <div class="card-buttons">
            <button
              class="btn-card btn-download"
              id="btnDownload"
              onclick="downloadCard()"
            >
              üì• SALVA
            </button>
            <button class="btn-card btn-print" onclick="printCard()">
              üñ®Ô∏è STAMPA
            </button>
            <button
              class="btn-card btn-leaderboard"
              onclick="showLeaderboard()"
            >
              üèÜ CLASSIFICA
            </button>
            <button class="btn-card btn-retry" onclick="riavvia()">
              üîÑ RIGIOCA
            </button>
            <button class="btn-card btn-home-end" onclick="tornaHome()">
              üè† HOME
            </button>
          </div>
        </div>
      </div>
    </div>

    <button class="pannello-toggle" id="pannelloToggle">‚öôÔ∏è</button>
    <div class="pannello" id="pannello">
      <h3>‚ö° GIOCO ‚ö°</h3>
      <div class="opzione">
        <label>üéÅ REGALO</label>
        <select id="emojiRegalo">
          <option value="üéÅ">üéÅ Regalo</option>
          <option value="‚≠ê">‚≠ê Stella</option>
          <option value="üéÑ">üéÑ Albero</option>
          <option value="üç™">üç™ Biscotto</option>
          <option value="üíé">üíé Diamante</option>
        </select>
      </div>
      <div class="opzione">
        <label>üíÄ NEMICO</label>
        <select id="emojiNemico">
          <option value="ü™®">ü™® Carbone</option>
          <option value="üí£">üí£ Bomba</option>
          <option value="üëª">üëª Fantasma</option>
          <option value="‚ò†Ô∏è">‚ò†Ô∏è Teschio</option>
        </select>
      </div>
      <div class="opzione">
        <label>üéÆ PLAYER</label>
        <select id="emojiPlayer" onchange="cambiaPlayer()">
          <option value="üõ∑">üõ∑ Slitta</option>
          <option value="üõ∏">üõ∏ UFO</option>
          <option value="ü§ñ">ü§ñ Robot</option>
          <option value="ü¶Ñ">ü¶Ñ Unicorno</option>
        </select>
      </div>
    </div>

    <div class="istruzioni">MUOVI IL MOUSE ‚Üê ‚Üí | PRENDI üéÅ EVITA ü™®</div>

    <script>
      // NEVE
      function createSnowflakes() {
        var container = document.getElementById("snowContainer");
        var snowflakes = ["‚ùÑ", "‚ùÖ", "‚ùÜ", "‚ú¶", "‚Ä¢"];
        for (var i = 0; i < 40; i++) {
          var flake = document.createElement("div");
          flake.className = "snowflake";
          flake.textContent =
            snowflakes[Math.floor(Math.random() * snowflakes.length)];
          flake.style.left = Math.random() * 100 + "%";
          flake.style.fontSize = Math.random() * 0.8 + 0.4 + "rem";
          flake.style.animationDuration = Math.random() * 5 + 6 + "s";
          flake.style.animationDelay = Math.random() * 10 + "s";
          flake.style.opacity = Math.random() * 0.5 + 0.3;
          container.appendChild(flake);
        }
      }
      createSnowflakes();

      // AUDIO
      var audioCtx = null,
        musicEnabled = true,
        musicVolume = 0.3,
        musicInterval = null,
        musicStep = 0;
      function initAudio() {
        if (!audioCtx)
          audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
      var jingleBells = [
        { freq: 659, dur: 0.2 },
        { freq: 0, dur: 0.05 },
        { freq: 659, dur: 0.2 },
        { freq: 0, dur: 0.05 },
        { freq: 659, dur: 0.4 },
        { freq: 0, dur: 0.1 },
        { freq: 659, dur: 0.2 },
        { freq: 0, dur: 0.05 },
        { freq: 659, dur: 0.2 },
        { freq: 0, dur: 0.05 },
        { freq: 659, dur: 0.4 },
        { freq: 0, dur: 0.1 },
        { freq: 659, dur: 0.2 },
        { freq: 0, dur: 0.05 },
        { freq: 784, dur: 0.2 },
        { freq: 0, dur: 0.05 },
        { freq: 523, dur: 0.2 },
        { freq: 0, dur: 0.05 },
        { freq: 587, dur: 0.2 },
        { freq: 0, dur: 0.05 },
        { freq: 659, dur: 0.6 },
        { freq: 0, dur: 0.2 },
        { freq: 698, dur: 0.2 },
        { freq: 0, dur: 0.05 },
        { freq: 698, dur: 0.2 },
        { freq: 0, dur: 0.05 },
        { freq: 698, dur: 0.3 },
        { freq: 0, dur: 0.05 },
        { freq: 698, dur: 0.15 },
        { freq: 0, dur: 0.05 },
        { freq: 698, dur: 0.2 },
        { freq: 0, dur: 0.05 },
        { freq: 659, dur: 0.2 },
        { freq: 0, dur: 0.05 },
        { freq: 659, dur: 0.2 },
        { freq: 0, dur: 0.05 },
        { freq: 659, dur: 0.15 },
        { freq: 0, dur: 0.05 },
        { freq: 659, dur: 0.2 },
        { freq: 0, dur: 0.05 },
        { freq: 587, dur: 0.2 },
        { freq: 0, dur: 0.05 },
        { freq: 587, dur: 0.2 },
        { freq: 0, dur: 0.05 },
        { freq: 659, dur: 0.2 },
        { freq: 0, dur: 0.05 },
        { freq: 587, dur: 0.3 },
        { freq: 0, dur: 0.05 },
        { freq: 784, dur: 0.5 },
        { freq: 0, dur: 0.3 },
      ];
      function playMusicNote() {
        if (!musicEnabled || !audioCtx || musicVolume === 0) return;
        var note = jingleBells[musicStep % jingleBells.length];
        if (note.freq > 0) {
          var osc = audioCtx.createOscillator(),
            gain = audioCtx.createGain();
          osc.connect(gain);
          gain.connect(audioCtx.destination);
          osc.type = "square";
          osc.frequency.setValueAtTime(note.freq, audioCtx.currentTime);
          gain.gain.setValueAtTime(0.12 * musicVolume, audioCtx.currentTime);
          gain.gain.linearRampToValueAtTime(
            0,
            audioCtx.currentTime + note.dur * 0.95
          );
          osc.start();
          osc.stop(audioCtx.currentTime + note.dur);
          if (musicStep % 4 === 0) {
            var bass = audioCtx.createOscillator(),
              bassGain = audioCtx.createGain();
            bass.connect(bassGain);
            bassGain.connect(audioCtx.destination);
            bass.type = "triangle";
            bass.frequency.setValueAtTime(note.freq / 4, audioCtx.currentTime);
            bassGain.gain.setValueAtTime(
              0.15 * musicVolume,
              audioCtx.currentTime
            );
            bassGain.gain.linearRampToValueAtTime(
              0,
              audioCtx.currentTime + 0.28
            );
            bass.start();
            bass.stop(audioCtx.currentTime + 0.3);
          }
        }
        musicStep++;
      }
      function startMusic() {
        if (musicInterval) return;
        initAudio();
        musicStep = 0;
        playMusicNote();
        musicInterval = setInterval(playMusicNote, 200);
      }
      function stopMusic() {
        if (musicInterval) {
          clearInterval(musicInterval);
          musicInterval = null;
        }
      }
      function toggleMusic() {
        initAudio();
        musicEnabled = !musicEnabled;
        var btn = document.getElementById("musicToggle");
        if (musicEnabled) {
          btn.textContent = "üéµ";
          btn.classList.remove("muted");
          startMusic();
        } else {
          btn.textContent = "üîá";
          btn.classList.add("muted");
          stopMusic();
        }
      }
      function setVolume(value) {
        musicVolume = parseInt(value) / 100;
        document.getElementById("volumeValue").textContent = value + "%";
      }
      function playSound(type) {
        if (!audioCtx || musicVolume === 0) return;
        var now = audioCtx.currentTime,
          vol = musicVolume;
        if (type === "collect") {
          [523, 659, 784].forEach(function (freq, i) {
            var osc = audioCtx.createOscillator(),
              gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.type = "sine";
            osc.frequency.setValueAtTime(freq, now + i * 0.1);
            gain.gain.setValueAtTime(0.3 * vol, now + i * 0.1);
            gain.gain.linearRampToValueAtTime(0, now + i * 0.1 + 0.2);
            osc.start(now + i * 0.1);
            osc.stop(now + i * 0.1 + 0.2);
          });
        } else if (type === "hit") {
          var osc = audioCtx.createOscillator(),
            gain = audioCtx.createGain();
          osc.connect(gain);
          gain.connect(audioCtx.destination);
          osc.type = "sawtooth";
          osc.frequency.setValueAtTime(150, now);
          osc.frequency.linearRampToValueAtTime(50, now + 0.2);
          gain.gain.setValueAtTime(0.4 * vol, now);
          gain.gain.linearRampToValueAtTime(0, now + 0.3);
          osc.start(now);
          osc.stop(now + 0.3);
        } else if (type === "combo") {
          [523, 659, 784, 1047].forEach(function (freq, i) {
            var osc = audioCtx.createOscillator(),
              gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.type = "sine";
            osc.frequency.setValueAtTime(freq, now + i * 0.08);
            gain.gain.setValueAtTime(0.2 * vol, now + i * 0.08);
            gain.gain.linearRampToValueAtTime(0, now + i * 0.08 + 0.15);
            osc.start(now + i * 0.08);
            osc.stop(now + i * 0.08 + 0.15);
          });
        } else if (type === "gameOver") {
          var osc = audioCtx.createOscillator(),
            gain = audioCtx.createGain();
          osc.connect(gain);
          gain.connect(audioCtx.destination);
          osc.type = "square";
          osc.frequency.setValueAtTime(440, now);
          osc.frequency.linearRampToValueAtTime(110, now + 0.8);
          gain.gain.setValueAtTime(0.3 * vol, now);
          gain.gain.linearRampToValueAtTime(0, now + 1);
          osc.start(now);
          osc.stop(now + 1);
        } else if (type === "levelUp") {
          [523, 659, 784, 1047, 784, 1047].forEach(function (freq, i) {
            var osc = audioCtx.createOscillator(),
              gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.type = "square";
            osc.frequency.setValueAtTime(freq, now + i * 0.1);
            gain.gain.setValueAtTime(0.15 * vol, now + i * 0.1);
            gain.gain.linearRampToValueAtTime(0, now + i * 0.1 + 0.12);
            osc.start(now + i * 0.1);
            osc.stop(now + i * 0.1 + 0.12);
          });
        } else if (type === "start") {
          var osc = audioCtx.createOscillator(),
            gain = audioCtx.createGain();
          osc.connect(gain);
          gain.connect(audioCtx.destination);
          osc.type = "sine";
          osc.frequency.setValueAtTime(200, now);
          osc.frequency.exponentialRampToValueAtTime(800, now + 0.3);
          gain.gain.setValueAtTime(0.3 * vol, now);
          gain.gain.linearRampToValueAtTime(0, now + 0.4);
          osc.start(now);
          osc.stop(now + 0.4);
        } else if (type === "newRecord") {
          [523, 659, 784, 1047, 1319, 1568].forEach(function (freq, i) {
            var osc = audioCtx.createOscillator(),
              gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.type = "sine";
            osc.frequency.setValueAtTime(freq, now + i * 0.12);
            gain.gain.setValueAtTime(0.25 * vol, now + i * 0.12);
            gain.gain.linearRampToValueAtTime(0, now + i * 0.12 + 0.2);
            osc.start(now + i * 0.12);
            osc.stop(now + i * 0.12 + 0.2);
          });
        }
      }

      // DIFFICULTY
      var difficultySettings = {
        easy: {
          speed: 3,
          spawnRate: 1200,
          enemyChance: 0.1,
          lives: 5,
          label: "FACILE",
          emoji: "üòä",
        },
        normal: {
          speed: 4,
          spawnRate: 1000,
          enemyChance: 0.2,
          lives: 3,
          label: "NORMALE",
          emoji: "üòê",
        },
        hard: {
          speed: 5.5,
          spawnRate: 800,
          enemyChance: 0.3,
          lives: 2,
          label: "DIFFICILE",
          emoji: "üòà",
        },
        impossible: {
          speed: 7,
          spawnRate: 600,
          enemyChance: 0.4,
          lives: 1,
          label: "IMPOSSIBILE",
          emoji: "üíÄ",
        },
      };
      var currentDifficulty = "normal";

      // LEADERBOARD
      function getLeaderboard() {
        try {
          return (
            JSON.parse(localStorage.getItem("giftCatcherLeaderboard")) || []
          );
        } catch (e) {
          return [];
        }
      }
      function saveLeaderboard(lb) {
        localStorage.setItem("giftCatcherLeaderboard", JSON.stringify(lb));
      }
      function addScore(name, score, difficulty) {
        var lb = getLeaderboard();
        lb.push({
          name: name,
          score: score,
          difficulty: difficulty,
          date: new Date().toISOString(),
        });
        lb.sort(function (a, b) {
          return b.score - a.score;
        });
        lb = lb.slice(0, 10);
        saveLeaderboard(lb);
        return lb;
      }
      function getPersonalBest(name) {
        var lb = getLeaderboard();
        var best = 0;
        lb.forEach(function (entry) {
          if (entry.name === name && entry.score > best) best = entry.score;
        });
        return best;
      }
      function showLeaderboard() {
        var lb = getLeaderboard();
        var list = document.getElementById("leaderboardList");
        list.innerHTML = "";
        if (lb.length === 0) {
          list.innerHTML =
            '<li class="leaderboard-empty">Nessun punteggio ancora!<br>Gioca per entrare in classifica!</li>';
        } else {
          lb.forEach(function (entry, i) {
            var li = document.createElement("li");
            li.className =
              "leaderboard-item" +
              (i === 0
                ? " gold"
                : i === 1
                ? " silver"
                : i === 2
                ? " bronze"
                : "");
            var diffLabel = difficultySettings[entry.difficulty]
              ? difficultySettings[entry.difficulty].emoji
              : "";
            li.innerHTML =
              '<span class="leaderboard-rank">#' +
              (i + 1) +
              '</span><span class="leaderboard-name">' +
              entry.name +
              '</span><span class="leaderboard-score">' +
              entry.score +
              '</span><span class="leaderboard-difficulty">' +
              diffLabel +
              "</span>";
            list.appendChild(li);
          });
        }
        document.getElementById("leaderboardModal").classList.add("visibile");
      }
      function hideLeaderboard() {
        document
          .getElementById("leaderboardModal")
          .classList.remove("visibile");
      }
      function clearScores() {
        if (confirm("Sei sicuro di voler cancellare tutti i punteggi?")) {
          localStorage.removeItem("giftCatcherLeaderboard");
          showLeaderboard();
        }
      }

      // ELEMENTI
      var startScreen = document.getElementById("startScreen"),
        btnStart = document.getElementById("btnStart"),
        nomeInput = document.getElementById("nomeGiocatore"),
        difficultySelect = document.getElementById("difficultySelect"),
        player = document.getElementById("player"),
        scoreEl = document.getElementById("score"),
        livelloEl = document.getElementById("livello"),
        viteEl = document.getElementById("vite"),
        difficultyDisplay = document.getElementById("difficultyDisplay"),
        gameOverScreen = document.getElementById("gameOverScreen"),
        comboEl = document.getElementById("combo"),
        newRecordEl = document.getElementById("newRecord"),
        pannelloToggle = document.getElementById("pannelloToggle"),
        pannello = document.getElementById("pannello"),
        emojiRegalo = document.getElementById("emojiRegalo"),
        emojiNemico = document.getElementById("emojiNemico"),
        emojiPlayer = document.getElementById("emojiPlayer");
      var scoreCard = document.getElementById("scoreCard"),
        cardNome = document.getElementById("cardNome"),
        cardScore = document.getElementById("cardScore"),
        cardLivello = document.getElementById("cardLivello"),
        cardRecord = document.getElementById("cardRecord"),
        cardAvatar = document.getElementById("cardAvatar"),
        cardBadge = document.getElementById("cardBadge"),
        cardTitle = document.getElementById("cardTitle"),
        cardMotto = document.getElementById("cardMotto"),
        cardBgEffect = document.getElementById("cardBgEffect");
      var nomeGiocatore = "PLAYER",
        punteggio = 0,
        vite = 3,
        livello = 1,
        combo = 0,
        giocoAttivo = false,
        intervalloSpawn,
        personalBest = 0,
        wasNewRecord = false;

      // CARD
      function setTheme(theme) {
        document.querySelectorAll(".theme-option").forEach(function (el) {
          el.classList.remove("selected");
        });
        document
          .querySelector('[data-theme="' + theme + '"]')
          .classList.add("selected");
        scoreCard.className = "score-card theme-" + theme;
      }
      function setAvatar(emoji) {
        document.querySelectorAll(".avatar-option").forEach(function (el) {
          el.classList.remove("selected");
        });
        event.target.classList.add("selected");
        cardAvatar.textContent = emoji;
      }
      function setEffect(effect) {
        cardBgEffect.className = "card-bg-effect effect-" + effect;
      }
      function setTitle(title) {
        cardTitle.textContent = title;
      }
      function setMotto(motto) {
        cardMotto.textContent = motto;
        cardMotto.style.display = motto ? "block" : "none";
      }
      function downloadCard() {
        var btn = document.getElementById("btnDownload");
        btn.disabled = true;
        btn.textContent = "‚è≥...";
        html2canvas(document.getElementById("scoreCard"), {
          backgroundColor: null,
          scale: 2,
          useCORS: true,
          logging: false,
        })
          .then(function (canvas) {
            var link = document.createElement("a");
            link.download = "GiftCatcher3000_" + nomeGiocatore + ".png";
            link.href = canvas.toDataURL("image/png");
            link.click();
            btn.disabled = false;
            btn.textContent = "üì• SALVA";
          })
          .catch(function () {
            btn.disabled = false;
            btn.textContent = "üì• SALVA";
          });
      }
      function printCard() {
        window.print();
      }

      // CONTROLLI
      document.addEventListener("mousemove", function (e) {
        if (giocoAttivo) player.style.left = e.clientX + "px";
      });
      document.addEventListener("keydown", function (e) {
        if (!giocoAttivo) return;
        var pos = parseFloat(player.style.left) || window.innerWidth / 2;
        if (e.key === "ArrowLeft")
          player.style.left = Math.max(50, pos - 30) + "px";
        else if (e.key === "ArrowRight")
          player.style.left = Math.min(window.innerWidth - 50, pos + 30) + "px";
      });
      nomeInput.addEventListener("keypress", function (e) {
        if (e.key === "Enter") iniziaGioco();
      });
      pannelloToggle.addEventListener("click", function () {
        pannello.classList.toggle("aperto");
      });
      function cambiaPlayer() {
        player.textContent = emojiPlayer.value;
      }

      // HOME
      function tornaHome() {
        giocoAttivo = false;
        clearInterval(intervalloSpawn);
        stopMusic();
        document.querySelectorAll(".oggetto").forEach(function (o) {
          o.remove();
        });
        gameOverScreen.classList.remove("visibile");
        startScreen.classList.remove("nascosta");
        punteggio = 0;
        livello = 1;
        combo = 0;
        scoreEl.textContent = "0";
        livelloEl.textContent = "1";
      }

      // GIOCO
      btnStart.addEventListener("click", iniziaGioco);
      function iniziaGioco() {
        initAudio();
        playSound("start");
        if (musicEnabled) startMusic();
        nomeGiocatore = nomeInput.value.trim() || "PLAYER";
        nomeGiocatore = nomeGiocatore.toUpperCase();
        currentDifficulty = difficultySelect.value;
        var settings = difficultySettings[currentDifficulty];
        personalBest = getPersonalBest(nomeGiocatore);
        wasNewRecord = false;
        startScreen.classList.add("nascosta");
        punteggio = 0;
        vite = settings.lives;
        livello = 1;
        combo = 0;
        giocoAttivo = true;
        scoreEl.textContent = "0";
        livelloEl.textContent = "1";
        difficultyDisplay.textContent = settings.emoji + " " + settings.label;
        aggiornaVite();
        player.style.left = window.innerWidth / 2 + "px";
        player.textContent = emojiPlayer.value;
        intervalloSpawn = setInterval(creaOggetto, settings.spawnRate);
      }

      function creaOggetto() {
        if (!giocoAttivo) return;
        var settings = difficultySettings[currentDifficulty];
        var oggetto = document.createElement("div");
        oggetto.className = "oggetto";
        var eNemico = Math.random() < settings.enemyChance;
        if (eNemico) {
          oggetto.textContent = emojiNemico.value;
          oggetto.classList.add("nemico");
          oggetto.dataset.nemico = "true";
        } else {
          oggetto.textContent = emojiRegalo.value;
          oggetto.dataset.nemico = "false";
        }
        oggetto.style.left = Math.random() * (window.innerWidth - 50) + "px";
        oggetto.style.top = "-50px";
        document.body.appendChild(oggetto);
        var velocita = settings.speed + livello * 0.5 + Math.random() * 2;
        var caduta = setInterval(function () {
          if (!giocoAttivo) {
            oggetto.remove();
            clearInterval(caduta);
            return;
          }
          var posY = parseFloat(oggetto.style.top);
          oggetto.style.top = posY + velocita + "px";
          var oRect = oggetto.getBoundingClientRect(),
            pRect = player.getBoundingClientRect();
          if (
            oRect.bottom >= pRect.top &&
            oRect.top <= pRect.bottom &&
            oRect.right >= pRect.left &&
            oRect.left <= pRect.right
          ) {
            if (oggetto.dataset.nemico === "true") {
              playSound("hit");
              vite--;
              combo = 0;
              aggiornaVite();
              mostraPopup(oRect.left, oRect.top, "üíî", true);
              document.body.classList.add("shake");
              setTimeout(function () {
                document.body.classList.remove("shake");
              }, 300);
              if (vite <= 0) gameOver();
            } else {
              playSound("collect");
              combo++;
              var punti = 10 * Math.min(combo, 5);
              punteggio += punti;
              scoreEl.textContent = punteggio;
              mostraPopup(oRect.left, oRect.top, "+" + punti, false);
              if (
                !wasNewRecord &&
                punteggio > personalBest &&
                personalBest > 0
              ) {
                wasNewRecord = true;
                playSound("newRecord");
                newRecordEl.classList.remove("visibile");
                void newRecordEl.offsetWidth;
                newRecordEl.classList.add("visibile");
              }
              if (combo > 0 && combo % 5 === 0) {
                playSound("combo");
                mostraCombo(combo);
              }
              if (punteggio >= livello * 150) {
                playSound("levelUp");
                livello++;
                livelloEl.textContent = livello;
                clearInterval(intervalloSpawn);
                var newRate = Math.max(
                  300,
                  difficultySettings[currentDifficulty].spawnRate - livello * 60
                );
                intervalloSpawn = setInterval(creaOggetto, newRate);
              }
            }
            oggetto.remove();
            clearInterval(caduta);
          }
          if (posY > window.innerHeight) {
            oggetto.remove();
            clearInterval(caduta);
          }
        }, 20);
      }

      function mostraPopup(x, y, testo, negativo) {
        var popup = document.createElement("div");
        popup.className = "popup-punti" + (negativo ? " negativo" : "");
        popup.textContent = testo;
        popup.style.left = x + "px";
        popup.style.top = y + "px";
        document.body.appendChild(popup);
        setTimeout(function () {
          popup.remove();
        }, 1000);
      }
      function mostraCombo(n) {
        comboEl.textContent = "üî• " + n + "x COMBO! üî•";
        comboEl.classList.remove("visibile");
        void comboEl.offsetWidth;
        comboEl.classList.add("visibile");
      }
      function aggiornaVite() {
        var cuori = "";
        for (var i = 0; i < vite; i++) cuori += "‚ù§Ô∏è";
        var maxVite = difficultySettings[currentDifficulty].lives;
        for (var i = 0; i < maxVite - vite; i++) cuori += "üñ§";
        viteEl.textContent = cuori;
      }

      function gameOver() {
        giocoAttivo = false;
        clearInterval(intervalloSpawn);
        playSound("gameOver");
        stopMusic();
        var lb = addScore(nomeGiocatore, punteggio, currentDifficulty);
        var isTop10 = lb.some(function (entry) {
          return entry.name === nomeGiocatore && entry.score === punteggio;
        });
        aggiornaCard(isTop10);
        gameOverScreen.classList.add("visibile");
        document.querySelectorAll(".oggetto").forEach(function (o) {
          o.remove();
        });
      }

      function aggiornaCard(isTop10) {
        cardNome.textContent = nomeGiocatore;
        cardScore.textContent = punteggio;
        cardLivello.textContent = livello;
        var lb = getLeaderboard();
        var best = 0;
        lb.forEach(function (entry) {
          if (entry.name === nomeGiocatore && entry.score > best)
            best = entry.score;
        });
        cardRecord.textContent = best;
        cardAvatar.textContent = emojiPlayer.value;
        document.querySelectorAll(".avatar-option").forEach(function (el) {
          el.classList.remove("selected");
          if (el.textContent === emojiPlayer.value)
            el.classList.add("selected");
        });
        if (!document.querySelector(".avatar-option.selected"))
          document.querySelector(".avatar-option").classList.add("selected");
        if (isTop10 && punteggio >= 500) cardBadge.textContent = "üëë LEGGENDA";
        else if (isTop10 && punteggio >= 300)
          cardBadge.textContent = "üèÜ CAMPIONE";
        else if (isTop10) cardBadge.textContent = "‚≠ê TOP 10!";
        else if (punteggio >= 150) cardBadge.textContent = "üéÆ PRO PLAYER";
        else cardBadge.textContent = "üéÆ PLAYER";
        if (wasNewRecord || (isTop10 && punteggio === best)) {
          cardTitle.textContent = "üéâ NUOVO RECORD!";
          document.getElementById("titleSelect").value = "HIGH SCORE";
        } else {
          cardTitle.textContent = "GAME COMPLETE";
          document.getElementById("titleSelect").value = "GAME COMPLETE";
        }
        cardMotto.textContent = "";
        cardMotto.style.display = "none";
        document.getElementById("mottoInput").value = "";
        setTheme("cyberpunk");
        setEffect("stars");
        document.getElementById("effectSelect").value = "stars";
      }

      function riavvia() {
        gameOverScreen.classList.remove("visibile");
        if (musicEnabled) startMusic();
        iniziaGioco();
      }
      player.style.left = window.innerWidth / 2 + "px";
    </script>
  </body>
</html>
